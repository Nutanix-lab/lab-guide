+++
title = "三层LAMP应用蓝图"
description = "基于LAMP技术堆栈的典型三层应用"
weight = 2
+++

本Lab的目标：
* 使用一个下载的别人开发的蓝图
* 导入在自己的项目中
* 在本地项目的蓝图编辑器里修改成一个可以正常运行的蓝图
* 使用当前项目的配额测试和部署这个蓝图的应用
* 使用和测试蓝图中所定义的自动化运维流程
* 修改和增加自定义的应用服务自动化维护场景（可选）

蓝图的下载地址：[http://lab.digitalformula.net/calm-lab-3.0/blueprints/2017.12.06.LAMP.RC6.json.zip](http://lab.digitalformula.net/calm-lab-3.0/blueprints/2017.12.06.LAMP.RC6.json.zip)

下载后解压缩得到蓝图的 json 文件。

在App页面中点击左侧的第二个按钮，进入蓝图管理，点击 Upload Blueprint 按钮，通过上传的方式新建一个蓝图。点击后选择刚才下载的json蓝图文件。

![1801514305371_.pic_hd](/media/15142875527032/1801514305371_.pic_hd.jpg)

输入这个蓝图在本地的名称和部署的项目。点击 上传 按钮。
![1811514305511_.pic_hd](/media/15142875527032/1811514305511_.pic_hd.jpg)

上传之后进入该蓝图的编辑模式，可以点击图中的红色感叹号，了解当前蓝图里必须修改的配置点。然后逐一检查和确认每一项配置，保证所有配置和当前的项目和资源池匹配。

![1821514305547_.pic_hd](/media/15142875527032/1821514305547_.pic_hd.jpg)

点击 Credentials 按钮，将密码更新为上述步骤中创建的模板机的root口令， Credentials name最好保持不变。点击空白处和密码查看的眼睛图标，确认密码应保存住了，点击 back 按钮。

![1831514305588_.pic_hd](/media/15142875527032/1831514305588_.pic_hd.jpg)

依次点击左下角Service清单中的三项服务，修改每项服务中的详细配置，如下图所示。
![1841514305691_.pic_hd](/media/15142875527032/1841514305691_.pic_hd.jpg)

确保使用正确的登录密码信息。
![1851514305714_.pic_hd](/media/15142875527032/1851514305714_.pic_hd.jpg)

点击保存按钮，确认整个蓝图的配置信息都是正确的，点击 Lunch 按钮部署这个蓝图。
![1861514305813_.pic_hd](/media/15142875527032/1861514305813_.pic_hd.jpg)

输入这次蓝图部署的名称，点击Create按钮，创建这个部署。
![1871514305848_.pic_hd](/media/15142875527032/1871514305848_.pic_hd.jpg)

在应用部署界面中观察 Create 工作流的执行状态。
![1891514306332_.pic_hd](/media/15142875527032/1891514306332_.pic_hd.jpg)

在虚拟机控制台里观察虚拟机创建的状态和结果。
![1901514307023_.pic_hd](/media/15142875527032/1901514307023_.pic_hd.jpg)

部署完毕之后可以范围 负载均衡 服务状态查看地址： http://10.21.11.55:8080/stats 

如果右下方的两个服务的状态都是UP的话，这表明整套服务部署成功了。然后访问 http://haproxy_vm_ip/ 浏览应用服务页面。

![1911514307055_.pic_hd](/media/15142875527032/1911514307055_.pic_hd.jpg)



{{% alert theme="warning" %}}**以上步骤的验收标准：** 可以登录用户蓝图生成的vm，能看到三层应用的Web界面。{{% /alert %}}

